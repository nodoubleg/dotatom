(function() {
  var alignment, escape,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  escape = require('escape-regexp');

  alignment = module.exports = function(text) {
    var alignText, leftSeparators, rightSeparators, separatorRegExp, separators, spaceSeparators;
    leftSeparators = atom.config.get('alignment.leftSeparators');
    rightSeparators = atom.config.get('alignment.rightSeparators');
    separators = leftSeparators.concat(rightSeparators);
    spaceSeparators = atom.config.get('alignment.spaceSeparators');
    separatorRegExp = new RegExp('^(?:"(?:\\\\"|.(?:\\\\\\\\)*)*"|\'(?:\\\\\'|.(?:\\\\\\\\)*)*\'|.)*?' + '(' + separators.map(escape).join('|') + ')');
    alignText = function(text) {
      var leftLength, lines, matches, parts, positions, rightLines, rightParts;
      lines = text.split('\n');
      matches = 0;
      parts = lines.map(function(line, index) {
        var match;
        match = line.match(separatorRegExp);
        if (!match) {
          return;
        }
        matches += 1;
        return [match[0].substr(0, match[0].length - match[1].length).trimRight(), match[1], line.substr(match[0].length).trimLeft()];
      });
      if (!matches) {
        return [text, []];
      }
      rightParts = alignText(parts.map(function(part) {
        if (part) {
          return part[2];
        } else {
          return '';
        }
      }).join('\n'));
      rightLines = rightParts[0].split('\n');
      leftLength = parts.reduce(function(prev, part) {
        var length, _ref;
        if (!part) {
          return prev;
        }
        length = part[0].length + part[1].length + 1;
        if (_ref = part[1], __indexOf.call(spaceSeparators, _ref) >= 0) {
          length += 1;
        }
        if (length > prev) {
          return length;
        } else {
          return prev;
        }
      }, 0);
      positions = [];
      text = parts.map(function(part, index) {
        var line, padding, position, spaces, _ref, _ref1;
        if (!part) {
          return lines[index];
        }
        line = part[0];
        spaces = leftLength - line.length;
        position = 0;
        if (_ref = part[1], __indexOf.call(spaceSeparators, _ref) >= 0) {
          line += ' ';
          spaces -= 1;
        }
        padding = Array(spaces - part[1].length).join(' ');
        if (_ref1 = part[1], __indexOf.call(leftSeparators, _ref1) >= 0) {
          positions.push([index, line.length]);
          line += part[1] + padding;
        } else {
          line += padding + part[1];
          positions.push([index, line.length - part[1].length]);
        }
        if (rightParts[1][index]) {
          positions.push([rightParts[1][index][0], rightParts[1][index][1] + line.length + 1]);
        }
        return line + ' ' + rightLines[index];
      }).join('\n');
      return [text, positions];
    };
    return alignText(text);
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICIiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbCiAgICAiIgogIF0sCiAgIm5hbWVzIjogW10sCiAgIm1hcHBpbmdzIjogIkFBQUE7QUFBQSxNQUFBLGlCQUFBO0lBQUEscUpBQUE7O0FBQUEsRUFBQSxNQUFBLEdBQVMsT0FBQSxDQUFRLGVBQVIsQ0FBVCxDQUFBOztBQUFBLEVBRUEsU0FBQSxHQUFZLE1BQU0sQ0FBQyxPQUFQLEdBQWlCLFNBQUMsSUFBRCxHQUFBO0FBQzNCLFFBQUEsd0ZBQUE7QUFBQSxJQUFBLGNBQUEsR0FBa0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFaLENBQWdCLDBCQUFoQixDQUFsQixDQUFBO0FBQUEsSUFDQSxlQUFBLEdBQWtCLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBWixDQUFnQiwyQkFBaEIsQ0FEbEIsQ0FBQTtBQUFBLElBRUEsVUFBQSxHQUFrQixjQUFjLENBQUMsTUFBZixDQUFzQixlQUF0QixDQUZsQixDQUFBO0FBQUEsSUFHQSxlQUFBLEdBQWtCLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBWixDQUFnQiwyQkFBaEIsQ0FIbEIsQ0FBQTtBQUFBLElBSUEsZUFBQSxHQUFzQixJQUFBLE1BQUEsQ0FDcEIscUVBQUEsR0FDQSxHQURBLEdBQ00sVUFBVSxDQUFDLEdBQVgsQ0FBZSxNQUFmLENBQXNCLENBQUMsSUFBdkIsQ0FBNEIsR0FBNUIsQ0FETixHQUN5QyxHQUZyQixDQUp0QixDQUFBO0FBQUEsSUFTQSxTQUFBLEdBQVksU0FBQyxJQUFELEdBQUE7QUFDVixVQUFBLG9FQUFBO0FBQUEsTUFBQSxLQUFBLEdBQVUsSUFBSSxDQUFDLEtBQUwsQ0FBVyxJQUFYLENBQVYsQ0FBQTtBQUFBLE1BQ0EsT0FBQSxHQUFVLENBRFYsQ0FBQTtBQUFBLE1BSUEsS0FBQSxHQUFRLEtBQUssQ0FBQyxHQUFOLENBQVUsU0FBQyxJQUFELEVBQU8sS0FBUCxHQUFBO0FBQ2hCLFlBQUEsS0FBQTtBQUFBLFFBQUEsS0FBQSxHQUFRLElBQUksQ0FBQyxLQUFMLENBQVcsZUFBWCxDQUFSLENBQUE7QUFFQSxRQUFBLElBQVUsQ0FBQSxLQUFWO0FBQUEsZ0JBQUEsQ0FBQTtTQUZBO0FBQUEsUUFJQSxPQUFBLElBQVcsQ0FKWCxDQUFBO2VBTUEsQ0FDRSxLQUFNLENBQUEsQ0FBQSxDQUFFLENBQUMsTUFBVCxDQUFnQixDQUFoQixFQUFtQixLQUFNLENBQUEsQ0FBQSxDQUFFLENBQUMsTUFBVCxHQUFrQixLQUFNLENBQUEsQ0FBQSxDQUFFLENBQUMsTUFBOUMsQ0FBcUQsQ0FBQyxTQUF0RCxDQUFBLENBREYsRUFFRSxLQUFNLENBQUEsQ0FBQSxDQUZSLEVBR0UsSUFBSSxDQUFDLE1BQUwsQ0FBWSxLQUFNLENBQUEsQ0FBQSxDQUFFLENBQUMsTUFBckIsQ0FBNEIsQ0FBQyxRQUE3QixDQUFBLENBSEYsRUFQZ0I7TUFBQSxDQUFWLENBSlIsQ0FBQTtBQW1CQSxNQUFBLElBQXFCLENBQUEsT0FBckI7QUFBQSxlQUFPLENBQUMsSUFBRCxFQUFPLEVBQVAsQ0FBUCxDQUFBO09BbkJBO0FBQUEsTUFzQkEsVUFBQSxHQUFhLFNBQUEsQ0FBVSxLQUFLLENBQUMsR0FBTixDQUFVLFNBQUMsSUFBRCxHQUFBO0FBQy9CLFFBQUEsSUFBRyxJQUFIO2lCQUFhLElBQUssQ0FBQSxDQUFBLEVBQWxCO1NBQUEsTUFBQTtpQkFBMEIsR0FBMUI7U0FEK0I7TUFBQSxDQUFWLENBRXRCLENBQUMsSUFGcUIsQ0FFaEIsSUFGZ0IsQ0FBVixDQXRCYixDQUFBO0FBQUEsTUEyQkEsVUFBQSxHQUFhLFVBQVcsQ0FBQSxDQUFBLENBQUUsQ0FBQyxLQUFkLENBQW9CLElBQXBCLENBM0JiLENBQUE7QUFBQSxNQThCQSxVQUFBLEdBQWEsS0FBSyxDQUFDLE1BQU4sQ0FBYSxTQUFDLElBQUQsRUFBTyxJQUFQLEdBQUE7QUFDeEIsWUFBQSxZQUFBO0FBQUEsUUFBQSxJQUFlLENBQUEsSUFBZjtBQUFBLGlCQUFPLElBQVAsQ0FBQTtTQUFBO0FBQUEsUUFFQSxNQUFBLEdBQVMsSUFBSyxDQUFBLENBQUEsQ0FBRSxDQUFDLE1BQVIsR0FBaUIsSUFBSyxDQUFBLENBQUEsQ0FBRSxDQUFDLE1BQXpCLEdBQWtDLENBRjNDLENBQUE7QUFJQSxRQUFBLFdBQUcsSUFBSyxDQUFBLENBQUEsQ0FBTCxFQUFBLGVBQVcsZUFBWCxFQUFBLElBQUEsTUFBSDtBQUNFLFVBQUEsTUFBQSxJQUFVLENBQVYsQ0FERjtTQUpBO0FBT08sUUFBQSxJQUFHLE1BQUEsR0FBUyxJQUFaO2lCQUFzQixPQUF0QjtTQUFBLE1BQUE7aUJBQWtDLEtBQWxDO1NBUmlCO01BQUEsQ0FBYixFQVNYLENBVFcsQ0E5QmIsQ0FBQTtBQUFBLE1BMENBLFNBQUEsR0FBWSxFQTFDWixDQUFBO0FBQUEsTUE2Q0EsSUFBQSxHQUFPLEtBQUssQ0FBQyxHQUFOLENBQVUsU0FBQyxJQUFELEVBQU8sS0FBUCxHQUFBO0FBQ2YsWUFBQSw0Q0FBQTtBQUFBLFFBQUEsSUFBdUIsQ0FBQSxJQUF2QjtBQUFBLGlCQUFPLEtBQU0sQ0FBQSxLQUFBLENBQWIsQ0FBQTtTQUFBO0FBQUEsUUFFQSxJQUFBLEdBQVcsSUFBSyxDQUFBLENBQUEsQ0FGaEIsQ0FBQTtBQUFBLFFBR0EsTUFBQSxHQUFXLFVBQUEsR0FBYSxJQUFJLENBQUMsTUFIN0IsQ0FBQTtBQUFBLFFBSUEsUUFBQSxHQUFXLENBSlgsQ0FBQTtBQU1BLFFBQUEsV0FBRyxJQUFLLENBQUEsQ0FBQSxDQUFMLEVBQUEsZUFBVyxlQUFYLEVBQUEsSUFBQSxNQUFIO0FBQ0UsVUFBQSxJQUFBLElBQVEsR0FBUixDQUFBO0FBQUEsVUFDQSxNQUFBLElBQVUsQ0FEVixDQURGO1NBTkE7QUFBQSxRQVVBLE9BQUEsR0FBVSxLQUFBLENBQU0sTUFBQSxHQUFTLElBQUssQ0FBQSxDQUFBLENBQUUsQ0FBQyxNQUF2QixDQUE4QixDQUFDLElBQS9CLENBQW9DLEdBQXBDLENBVlYsQ0FBQTtBQVlBLFFBQUEsWUFBRyxJQUFLLENBQUEsQ0FBQSxDQUFMLEVBQUEsZUFBVyxjQUFYLEVBQUEsS0FBQSxNQUFIO0FBQ0UsVUFBQSxTQUFTLENBQUMsSUFBVixDQUFlLENBQUMsS0FBRCxFQUFRLElBQUksQ0FBQyxNQUFiLENBQWYsQ0FBQSxDQUFBO0FBQUEsVUFDQSxJQUFBLElBQVEsSUFBSyxDQUFBLENBQUEsQ0FBTCxHQUFVLE9BRGxCLENBREY7U0FBQSxNQUFBO0FBSUUsVUFBQSxJQUFBLElBQVEsT0FBQSxHQUFVLElBQUssQ0FBQSxDQUFBLENBQXZCLENBQUE7QUFBQSxVQUNBLFNBQVMsQ0FBQyxJQUFWLENBQWUsQ0FBQyxLQUFELEVBQVEsSUFBSSxDQUFDLE1BQUwsR0FBYyxJQUFLLENBQUEsQ0FBQSxDQUFFLENBQUMsTUFBOUIsQ0FBZixDQURBLENBSkY7U0FaQTtBQW1CQSxRQUFBLElBQUcsVUFBVyxDQUFBLENBQUEsQ0FBRyxDQUFBLEtBQUEsQ0FBakI7QUFDRSxVQUFBLFNBQVMsQ0FBQyxJQUFWLENBQWUsQ0FDYixVQUFXLENBQUEsQ0FBQSxDQUFHLENBQUEsS0FBQSxDQUFPLENBQUEsQ0FBQSxDQURSLEVBRWIsVUFBVyxDQUFBLENBQUEsQ0FBRyxDQUFBLEtBQUEsQ0FBTyxDQUFBLENBQUEsQ0FBckIsR0FBMEIsSUFBSSxDQUFDLE1BQS9CLEdBQXdDLENBRjNCLENBQWYsQ0FBQSxDQURGO1NBbkJBO2VBeUJBLElBQUEsR0FBTyxHQUFQLEdBQWEsVUFBVyxDQUFBLEtBQUEsRUExQlQ7TUFBQSxDQUFWLENBMkJOLENBQUMsSUEzQkssQ0EyQkEsSUEzQkEsQ0E3Q1AsQ0FBQTthQTJFQSxDQUFDLElBQUQsRUFBTyxTQUFQLEVBNUVVO0lBQUEsQ0FUWixDQUFBO1dBd0ZBLFNBQUEsQ0FBVSxJQUFWLEVBekYyQjtFQUFBLENBRjdCLENBQUE7QUFBQSIKfQ==
//# sourceURL=/Users/gmason/.atom/packages/alignment/lib/alignment.coffee